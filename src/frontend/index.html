<html>
<script>
	user  = window.prompt("Please enter username(password is the same)",""); 
  ugly_tab = "&nbsp;&nbsp;&nbsp;&nbsp;";	
	socket = new WebSocket("ws://188.166.94.208:1337");  

	socket.onopen= function (){
		appendToOut("started connection");
		sleepFor(100);
		socket.send("server;"+user+";HANDSHAKE;null;"+new Date().getTime()+";");
		appendToOut("Sent handhsake");
		socket.send("server;"+user+";REGISTRATION;null;"+new Date().getTime()+";"+user+";"+user+";");
		appendToOut("Sent registration");

	}
	
	socket.onmessage = function (env){
		data = env.data;
		appendToOut(basicMessageFormat(new Message(data)));
	}

	function ass(){
		val =	document.getElementById("input").value;
		document.getElementById("input").value = "";
		socket.send(val);
		output = document.getElementById("output");
		output.innerHTML += "sent message: " + val + "<br>"
	}


	function appendToOut(text){
		output = document.getElementById("output");
		output.innerHTML += text + "<br>";
	}

	function sleepFor( sleepDuration ){
	    var now = new Date().getTime();
			while(new Date().getTime() < now + sleepDuration){ /* do nothing */ } 
	}

	function Message(message){
		
		split_array = message.split(";");
		this.receiver = split_array[0];
		this.sender = split_array[1];
		this.type = split_array[2];
		this.action = split_array[3];
		this.time_stamp = split_array[4];

		this.args = [];
	
		for(i = 5; i < split_array.length; i++){
			this.args.push(split_array[i]);
		}

	}

	function basicMessageFormat(message){
		str = "Message:<br>";
		str += ugly_tab+"Type: " + message.type + "<br>";
		str += ugly_tab+"Action: " + message.action + "<br>";
		str += ugly_tab+"Time Stamp: " + message.time_stamp + "<br>";
		str += ugly_tab+"Arguments: " + "<br>";
		if(message.args.length == 0){
			str += ugly_tab+ugly_tab+"NONE" + "<br>";
		}else{
			for(i = 0; i < message.args.length; i++){
				str += ugly_tab+ugly_tab+message.args[i] + "<br>";
			}
		
		}

		return str;
		
	}


</script>
<body>

<div>
	<div id="output" style="overflow-y:scroll; height:400px;">
		test :D<br>
	</div>
	<div>
		<input type="text" id="input" onkeydown="if (event.keyCode == 13) ass()">
	</div>

</div>


</body>

</html>
